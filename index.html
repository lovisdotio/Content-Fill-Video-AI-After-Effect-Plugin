<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Generative Fill Video - Lovis Odin</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>Generative Fill Video</h1>
            <p class="author">by Lovis Odin</p>
        </div>

        <div class="help-section">
            <details>
                <summary>üìã Quick Setup Guide</summary>
                <ol>
                    <li><strong>Open a composition</strong> in After Effects</li>
                    <li><strong>Select a video layer</strong></li>
                    <li><strong>Create a mask</strong> (Pen Tool or Shape) around the area to replace</li>
                    <li><strong>Keep the layer selected</strong> and use this plugin</li>
                </ol>
                <div class="debug-section">
                    <button id="debugBtn" onclick="openDebugConsole()">üîç Debug Console</button>
                    <p style="font-size: 11px; color: #888; margin-top: 5px;">Open debug tools if you encounter issues</p>
                </div>
            </details>
        </div>

        <div class="form-group">
            <label for="apiKey">FAL.ai API Key</label>
            <input type="password" id="apiKey" placeholder="Paste your FAL_KEY here">
            <small>Get your key at <a href="https://fal.ai" target="_blank">fal.ai</a></small>
        </div>

        <hr>

        <div class="form-group">
            <label for="modelSelection">AI Model</label>
            <select id="modelSelection">
    <option value="generative-fill">Generative Fill (Mask + Prompt) - Wan v2.1</option>
    <option value="video-to-video">Video to Video (Prompt Only) - Wan v2.2</option>
</select>
        </div>

        <!-- Mask Warning for Wan 2.1 -->
        <div id="mask-warning" style="background: #ffebee; border: 1px solid #f44336; border-radius: 4px; padding: 8px; margin: 10px 0; display: block;">
            <p style="color: #d32f2f; margin: 0; font-size: 12px; font-weight: bold;">
                ‚ö†Ô∏è <strong>IMPORTANT:</strong> For best results with Wan v2.1, use an <strong>INVERTED mask</strong> (mask the area you want to KEEP, not the area you want to replace).
            </p>
        </div>

        <div id="generative-fill-options">
            <div class="form-group">
                <label for="prompt">Prompt</label>
                <textarea id="prompt" rows="3" placeholder="A cinematic shot of a boat in the ocean..."></textarea>
            </div>
        </div>

        <div id="video-to-video-options" style="display: none;">
            <div class="form-group">
                <label for="videoPrompt">Prompt</label>
                <textarea id="videoPrompt" rows="3" placeholder="A low-angle medium shot of a cat..."></textarea>
            </div>
            <div class="form-group-inline">
                <label for="strength">Strength</label>
                <input type="number" id="strength" value="0.9" min="0" max="1" step="0.1">
            </div>
            <div class="form-group-inline">
                <label for="num_frames">Number of Frames</label>
                <input type="number" id="num_frames" value="81" min="81" max="121">
            </div>
            <div class="form-group-inline">
                <label for="frames_per_second">FPS</label>
                <input type="number" id="frames_per_second" value="16" min="4" max="60">
            </div>
        </div>

        <details>
            <summary>Advanced Settings</summary>
            <div class="form-group">
                <label for="negative_prompt">Negative Prompt</label>
                <textarea id="negative_prompt" rows="3" placeholder="low quality, blur, watermark..."></textarea>
            </div>
            <div class="form-group-inline">
                <label for="resolution">Resolution</label>
                <select id="resolution">
                    <option value="720p" selected>720p</option>
                    <option value="580p">580p</option>
                    <option value="480p">480p</option>
                </select>
            </div>
            <div class="form-group-inline">
                <label for="num_inference_steps">Inference Steps</label>
                <input type="number" id="num_inference_steps" value="30" min="1" max="100">
            </div>
        </details>

        <button id="generate-btn">Generate</button>

        <div id="status-area">
            <p id="status-text">Status: Ready</p>
            <progress id="progress-bar" value="0" max="100" style="width: 100%; display: none;"></progress>
        </div>

        <div id="debug-logs" style="display: none;">
            <h4>Debug Logs:</h4>
            <div id="log-content" style="background: #1e1e1e; color: #fff; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 11px; max-height: 200px; overflow-y: auto; white-space: pre-wrap;"></div>
        </div>

        <!-- Important Warnings -->
        <div class="warnings" style="background: #ffebee; border: 1px solid #e57373; border-radius: 4px; padding: 12px; margin-top: 20px;">
            <h4 style="color: #c62828; margin: 0 0 8px 0; font-size: 13px;">‚ö†Ô∏è IMPORTANT NOTICES:</h4>
            <ul style="color: #c62828; margin: 0; padding-left: 18px; font-size: 11px; line-height: 1.4;">
                <li><strong>ENABLE SCRIPT PERMISSIONS:</strong> Go to "Preferences > Scripting & Expressions" and check "Allow Scripts to Write Files and Access Network"</li>
                <li><strong>SAVE YOUR COMPOSITION</strong> before processing - this plugin modifies your project</li>
                <li><strong>24 FPS ONLY</strong> - Other frame rates are not supported</li>
                <li><strong>240 FRAMES MAX</strong> - Longer compositions will be truncated</li>
                <li><strong>ESTIMATED COST: Varies from ~$0.02 to ~$0.20 per second.</strong> Check <a href="https://fal.ai" target="_blank">fal.ai</a> for current pricing.</li>
                <li><strong>OUTPUT RESOLUTION: Varies by model and settings.</strong> May not match your composition settings.</li>
            </ul>
        </div>

        <div class="footer">
            <small>Powered by fal.ai ‚Ä¢ Created by Lovis Odin</small>
        </div>
    </div>

    <!-- Fallback Download Modal -->
    <div id="fallback-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <h3>Download Failed</h3>
            <p>The video could not be imported automatically, likely due to system permissions.</p>
            <p>You can download it manually from the link below.</p>
            <div class="form-group">
                <label for="fallback-url">Video URL</label>
                <input type="text" id="fallback-url" readonly style="background:#555;">
            </div>
            <div class="modal-buttons">
                <a id="fallback-link" href="#" target="_blank" class="button-link">Open Download Link</a>
                <button id="copy-url-btn">Copy URL</button>
            </div>
        </div>
    </div>


    <!-- CEP Libraries -->
    <script src="js/libs/CSInterface.js"></script>
    <!-- Official FAL.ai Client (Bundled) -->
    <script src="js/fal-client-bundled.js"></script>
    <!-- Fallback FAL.ai Client (Custom) -->
    <script src="js/fal-client.js"></script>
    <!-- Our JavaScript -->
    <script src="js/main.js"></script>
</body>
</html>